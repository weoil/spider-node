module.exports=function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=0)}([function(t,e,r){"use strict";(function(t){var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),i=this&&this.__assign||Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},o=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))(function(i,o){function s(t){try{u(n.next(t))}catch(t){o(t)}}function a(t){try{u(n.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new r(function(e){e(t.value)}).then(s,a)}u((n=n.apply(t,e||[])).next())})},s=this&&this.__generator||function(t,e){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(e,"__esModule",{value:!0});var a=r(2),u=r(3),c=r(4),l=r(5),f=r(8),p=function(t){function e(e){void 0===e&&(e={});var r=t.call(this)||this;return r.middleware={},r.isFirstStart=!0,r.runCount=0,r.isTest=!1,r.hasPlan=!1,r.spiders={},r.config=i({maxConnect:0},e),r.init(),r}return n(e,t),e.prototype.init=function(){this.on("pushTask",this._pushTask),this.on("finished",this._finished),this.on("parse",this._parse),this.on("download",this._download),this.on("downloadCompletion",this._downloadCompletion)},e.prototype.use=function(t,e){"function"==typeof t&&t(this,e)},e.prototype.registry=function(t,e){if(!t)throw new Error("You need to specify spider a name");if(!e)throw new Error("You need to specify spider a config");if(this.spiders[t])throw new Error("Already has a spider named "+t);e.delay&&(e.maxConnect=1),e.overList||(e.overList=new Set),this.spiders[t]={config:e,runCount:0,parseCount:0,tasklist:new Array,http:new l.default(i({},e.http,{overList:e.overList}),e.downloadMiddleware,e.errorMiddleware)}},e.prototype.start=function(t,e,r){return o(this,void 0,void 0,function(){var n,i;return s(this,function(o){switch(o.label){case 0:if(!this.spiders[t])throw new Error("No spider name is "+t);if(!e||Array.isArray(e)&&!e.length)throw new Error(t+" need to start url or urls");return this.isFirstStart&&(this.emit("open",{name:t}),this.isFirstStart=!1),n=this.spiders[t],r&&(r.timer=null,n.plan=r,this.hasPlan=!0),i=n.config.open,i?[4,i.call(n.config,n.config)]:[3,2];case 1:o.sent(),o.label=2;case 2:return this.emit("pushTask",{name:t,url:e}),[2]}})})},e.prototype.test=function(t,e){return o(this,void 0,void 0,function(){return s(this,function(r){switch(r.label){case 0:return this.isTest=!0,[4,this.start(t,e)];case 1:return r.sent(),[2]}})})},e.prototype._download=function(t){return o(this,void 0,void 0,function(){var e,r,n;return s(this,function(i){switch(i.label){case 0:return e=t.name,r=t.url,[4,this.spiders[e].http.request(r)];case 1:return n=i.sent(),this.emit("downloadCompletion",{name:e,url:r}),n instanceof Error?this.emit("error",{name:e,error:n}):n&&this.emit("parse",{name:e,url:r,content:n}),[2]}})})},e.prototype._parse=function(t){return o(this,void 0,void 0,function(){var e,r,n,i,o,a,l,p,h,d,y,v,m,w,b;return s(this,function(s){switch(s.label){case 0:for(e=t.name,r=t.url,n=t.content,i=this.spiders[e],o=i.config.rules,a=[],i.parseCount+=1,h=0,d=o;h<d.length;h++)y=d[h],i.plan&&!f.testExist(i.plan.include,r)||((v=new RegExp(y.test,"g")).test(r)&&(l=y.parse,p=y.pipeline),this.isTest||i.plan&&!f.testExist(i.plan.findlist,r)||(m=n.match(v),Array.isArray(m)&&m.forEach(function(t){t=u.resolve(r,t),a.includes(t)||a.push(t)})));this.emit("pushTask",{name:e,url:a}),s.label=1;case 1:return s.trys.push([1,6,,7]),l?[4,l.call(i.config,r,n,c.load(n),i.config)]:[3,5];case 2:return w=s.sent(),p?[4,p.call(i.config,w,i.config)]:[3,4];case 3:s.sent(),s.label=4;case 4:s.label=5;case 5:return[3,7];case 6:return b=s.sent(),console.log(b),this._callMiddleware(i.config.errorMiddleware,b),this.emit("error",{name:e,error:b}),[3,7];case 7:return i.parseCount-=1,this.emit("finished",{name:e,url:r,item:w}),[2]}})})},e.prototype._finished=function(t){return o(this,void 0,void 0,function(){var e,r,n,i,o=this;return s(this,function(s){switch(s.label){case 0:return e=t.name,0!==(r=this.spiders[e]).runCount||r.tasklist.length||0!==r.parseCount?[3,3]:r.plan?(r.plan.timer&&clearTimeout(r.plan.timer),r.plan.timer=setTimeout(function(){o.emit("plan",{name:e}),(Array.isArray(r.plan.url)?r.plan.url:[r.plan.url]).forEach(function(t){r.config.overList.delete(t)}),o.emit("pushTask",{name:e,url:r.plan.url})},r.plan.interval),[2]):(n=r.config.close)&&"function"==typeof n?[4,r.config.close.call(r.config,r.config)]:[3,2];case 1:s.sent(),s.label=2;case 2:if(0===this.runCount&&!this.hasPlan){for(i in this.spiders)if(this.spiders[i].tasklist.length)return[2];this.emit("close",{crawl:this})}s.label=3;case 3:return[2]}})})},e.prototype._downloadCompletion=function(t){var e=t.name,r=this.spiders[e];if(r.runCount-=1,this.runCount-=1,this._checkSpider(e)&&r.tasklist.length){var n=r.tasklist.pop();n&&this.emit("pushTask",{name:e,url:n})}},e.prototype._request=function(t){var e=this,r=t.name,n=t.url;this.emit("request",{name:r,url:n});var i=this.spiders[r];i.runCount+=1,this.runCount+=1;var o=i.config.delay||0;setTimeout(function(){e.emit("download",{name:r,url:n})},o)},e.prototype._pushTask=function(t){var e=this,r=t.name,n=t.url;(Array.isArray(n)?n:[n]).forEach(function(t){t&&(e._checkSpider(r)?e._request({name:r,url:t}):e.spiders[r].tasklist.push(t))})},e.prototype._checkSpider=function(t){if(this.config.maxConnect&&this.runCount>=this.config.maxConnect)return!1;var e=this.spiders[t],r=e.config;return!(r.maxConnect&&e.runCount>=r.maxConnect)},e.prototype._callMiddleware=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];var n=Array.isArray(t)?t:this.middleware[t];if(n)for(var i=0,o=n;i<o.length;i++){o[i].apply(void 0,e)}},e}(a);t&&t.exports&&(t.exports=p),e.default=p}).call(this,r(1)(t))},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e){t.exports=require("events")},function(t,e){t.exports=require("url")},function(t,e){t.exports=require("cheerio")},function(t,e,r){"use strict";var n=this&&this.__assign||Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},i=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))(function(i,o){function s(t){try{u(n.next(t))}catch(t){o(t)}}function a(t){try{u(n.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new r(function(e){e(t.value)}).then(s,a)}u((n=n.apply(t,e||[])).next())})},o=this&&this.__generator||function(t,e){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(e,"__esModule",{value:!0});var s=r(6),a=r(7),u=function(){function t(t,e,r){this.config=t,this.middleware=e,this.errorMiddleware=r,this.$=s.default.create(this.config)}return t.prototype.callMiddleware=function(t,e){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];return i(this,void 0,void 0,function(){var n,i;return o(this,function(o){switch(o.label){case 0:if(!e)return[2,!0];n=0,i=e,o.label=1;case 1:return n<i.length?[4,i[n].apply(void 0,[t].concat(r))]:[3,4];case 2:if(!1===o.sent())return[2,!1];o.label=3;case 3:return n++,[3,1];case 4:return[2]}})})},t.prototype.request=function(t){return i(this,void 0,void 0,function(){var e,r;return o(this,function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),[4,this.callMiddleware(t,this.middleware,this.config)];case 1:return!1===i.sent()?[2]:[4,this.$(n({url:t,method:"get"},this.config,{responseType:"arraybuffer"}))];case 2:return e=i.sent(),[2,this.decode(e.data,this.config.charset)];case 3:return r=i.sent(),console.log(r.message),this.callMiddleware(t,this.errorMiddleware,r),[2,r];case 4:return[2]}})})},t.prototype.decode=function(t,e){if(e)return a.decode(t,e);var r=a.decode(t,"utf8");try{e=(e=/charset\=[^"].*"|charset\="[^"].*"/.exec(r)[0]).replace("charset=","").replace(/"/g,"").replace("-","").trim()}catch(t){e="utf8"}return"utf8"===e.toLowerCase()?r:a.decode(t,e)},t}();e.default=u},function(t,e){t.exports=require("axios")},function(t,e){t.exports=require("iconv-lite")},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.testExist=function(t,e){for(var r=0,n=Array.isArray(t)?t:[t];r<n.length;r++)if(n[r].test(e))return!0;return!1}}]);